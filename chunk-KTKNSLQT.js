import{A as l,B as k,m,n as g,o as M,p as w,r as c,s as b,u as p,x as d,y as u}from"./chunk-42VJHPQG.js";import{S as D,Y as v,Za as r}from"./chunk-N63BWLFA.js";import{a as n,b as a,e as f}from"./chunk-ACKELEN3.js";var $="movimientos",O=class h{_firestore=v(w);_collectionRef=b(this._firestore,$);_utils=v(g);movements$=r([]);loading$=r(!1);mockMovements=r(k.Movements);getMovement(e,o){if(this.loading$.set(!0),m.mockUp)return setTimeout(()=>{this.loading$.set(!1)},2e3),e&&o?r(this.mockMovements().filter(t=>t.idAhorros===e.id&&t.tipo===o.id)):o?r(this.mockMovements().filter(t=>t.tipo===o.id)):e?r(this.mockMovements().filter(t=>t.idAhorros===e.id)):this.mockMovements;let i;if(e&&o){let t=d(this._collectionRef,l("idAhorros","==",e.id),l("tipo","==",o.id));i=c(t,{idField:"id"})}else if(o){let t=d(this._collectionRef,l("tipo","==",o.id));i=c(t,{idField:"id"})}else if(e){let t=d(this._collectionRef,l("idAhorros","==",e.id));i=c(t,{idField:"id"})}else i=c(this._collectionRef,{idField:"id"});return i.subscribe({next:t=>{this.movements$.set(t.map(s=>({id:s.id,cantidad:s.cantidad,tipo:s.tipo,descripcion:s.descripcion,fecha:s.fecha.toDate().toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}),familiar:s.familiar,idAhorros:s.idAhorros}))),this.loading$.set(!1)},error:t=>{this.loading$.set(!1),console.error("Error al obtener la colecci\xF3n: ",t)}}),this.movements$}withDraw(e){return f(this,null,function*(){if(this.loading$.set(!0),m.mockUp){e.fecha=new Date(e.fecha).toLocaleDateString("es-ES",{dateStyle:"long"}),yield this._utils.delay(1);let i=a(n({},e),{id:this._utils.generateId(),tipo:"retiro"});this.mockMovements.set(this.mockMovements().concat(i)),this.loading$.set(!1);return}let o=a(n({},e),{fecha:M.fromDate(new Date(e.fecha)),tipo:"retiro"});try{yield u(p(this._collectionRef),o)}catch(i){throw i}finally{this.loading$.set(!1)}})}save(e){return f(this,null,function*(){if(this.loading$.set(!0),m.mockUp){e.fecha=new Date(e.fecha).toLocaleDateString("es-ES",{dateStyle:"long"}),yield this._utils.delay(1);let i=a(n({},e),{id:this._utils.generateId(),tipo:"deposito"});this.mockMovements.set(this.mockMovements().concat(i)),this.loading$.set(!1);return}let o=a(n({},e),{fecha:M.fromDate(new Date(e.fecha)),tipo:"deposito"});try{yield u(p(this._collectionRef),o)}catch(i){throw i}finally{this.loading$.set(!1)}})}static \u0275fac=function(o){return new(o||h)};static \u0275prov=D({token:h,factory:h.\u0275fac,providedIn:"root"})};export{O as a};
