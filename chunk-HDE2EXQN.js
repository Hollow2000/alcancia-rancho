import{k as b}from"./chunk-3WJ5JSSG.js";import{b as u,c as w,e as c,f as $,h as M,j as d,k as p,m as l}from"./chunk-F3QCDJXU.js";import{J as m,K as g}from"./chunk-5CKZWRBR.js";import{Pa as n,S as D,Y as v}from"./chunk-O2BEBOXS.js";import{a as r,b as a,e as f}from"./chunk-ACKELEN3.js";var O="movimientos",k=class h{_firestore=v(w);_collectionRef=$(this._firestore,O);_utils=v(g);movements$=n([]);loading$=n(!1);mockMovements=n(b.Movements);getMovement(e,i){if(this.loading$.set(!0),m.mockUp)return setTimeout(()=>{this.loading$.set(!1)},2e3),e&&i?n(this.mockMovements().filter(o=>o.idAhorros===e.id&&o.tipo===i.id)):i?n(this.mockMovements().filter(o=>o.tipo===i.id)):e?n(this.mockMovements().filter(o=>o.idAhorros===e.id)):this.mockMovements;let t;if(e&&i){let o=d(this._collectionRef,l("idAhorros","==",e.id),l("tipo","==",i.id));t=c(o,{idField:"id"})}else if(i){let o=d(this._collectionRef,l("tipo","==",i.id));t=c(o,{idField:"id"})}else if(e){let o=d(this._collectionRef,l("idAhorros","==",e.id));t=c(o,{idField:"id"})}else t=c(this._collectionRef,{idField:"id"});return t.subscribe({next:o=>{this.movements$.set(o.map(s=>({id:s.id,cantidad:s.cantidad,tipo:s.tipo,descripcion:s.descripcion,fecha:s.fecha.toDate().toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}),familiar:s.familiar,idAhorros:s.idAhorros}))),this.loading$.set(!1)},error:o=>{this.loading$.set(!1),console.error("Error al obtener la colecci\xF3n: ",o)}}),this.movements$}withDraw(e){return f(this,null,function*(){if(this.loading$.set(!0),m.mockUp){e.fecha=new Date(e.fecha).toLocaleDateString("es-ES",{dateStyle:"long"}),yield this._utils.delay(1);let t=a(r({},e),{id:this._utils.generateId(),tipo:"retiro"});this.mockMovements.set(this.mockMovements().concat(t)),this.loading$.set(!1);return}let i=a(r({},e),{fecha:u.fromDate(new Date(e.fecha)),tipo:"retiro"});yield p(M(this._collectionRef),i).then(t=>(this.loading$.set(!1),t)).catch(t=>{throw this.loading$.set(!1),t})})}save(e){return f(this,null,function*(){if(this.loading$.set(!0),m.mockUp){e.fecha=new Date(e.fecha).toLocaleDateString("es-ES",{dateStyle:"long"}),yield this._utils.delay(1);let t=a(r({},e),{id:this._utils.generateId(),tipo:"deposito"});this.mockMovements.set(this.mockMovements().concat(t)),this.loading$.set(!1);return}let i=a(r({},e),{fecha:u.fromDate(new Date(e.fecha)),tipo:"deposito"});yield p(M(this._collectionRef),i).then(t=>(this.loading$.set(!1),t)).catch(t=>{throw this.loading$.set(!1),t})})}static \u0275fac=function(i){return new(i||h)};static \u0275prov=D({token:h,factory:h.\u0275fac,providedIn:"root"})};export{k as a};
