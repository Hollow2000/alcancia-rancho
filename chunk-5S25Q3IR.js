import{D as S,c as m,d as f,f as g,g as v,i as _,j as p,k as y,l as h,m as w,n as i,o as U}from"./chunk-DWDFKIHE.js";import{X as l,ba as o,g as u}from"./chunk-UK2LV4O3.js";import{e as r}from"./chunk-ACKELEN3.js";var c=class a{concurrentReq=0;_isLoading=new u(0);isLoading=this._isLoading.asObservable();show(){this._isLoading.next(++this.concurrentReq)}hide(){this._isLoading.next(--this.concurrentReq)}static \u0275fac=function(e){return new(e||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};var k=class a{_auth=o(f);_utils=o(U);_loaderService=o(c);_familyService=o(S);mockIsLogged=i.isLogged;constructor(){this._auth.useDeviceLanguage()}get authState$(){return g(this._auth)}isAdmin(){return r(this,null,function*(){return this._auth.currentUser?.uid?(yield this._familyService.getFamily(this._auth.currentUser?.uid))?.admin??!1:!1})}logOut(){return r(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!1,Promise.resolve();let t=yield h(this._auth);return this._loaderService.hide(),t})}singUp(t,e){return r(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!0,Promise.resolve();try{return yield v(this._auth,t,e)}catch(s){throw s}finally{this._loaderService.hide()}})}login(t,e){return r(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!0,Promise.resolve();let s=yield p(this._auth,t,e).then(d=>(this._loaderService.hide(),d)).catch(d=>{throw this._loaderService.hide(),d}),n=yield this._familyService.getFamily(s.user.uid);if(!n||n.deleted)throw yield h(this._auth),{message:"Usuario eliminado"};return s})}recoverPassword(t){return r(this,null,function*(){this._loaderService.show();try{yield _(this._auth,t)}catch(e){throw e}finally{this._loaderService.hide()}})}updateName(t){return r(this,null,function*(){this._auth.currentUser&&!i.mockUp&&(this._familyService.loading$.set(!0),yield w(this._auth.currentUser,{displayName:t}),this._familyService.loading$.set(!1))})}getUserName(){return i.mockUp?"Mock Up":this._auth.currentUser?.displayName}getUID(){return i.mockUp?null:this._auth.currentUser?.uid}getUserImage(){return i.mockUp?void 0:this._auth.currentUser?.photoURL??void 0}signInWithGoogle(){return r(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!0,Promise.resolve();try{let t=yield y(this._auth,new m),e=yield this._familyService.getFamily(this._auth.currentUser?.uid);if(e){if(e.deleted)throw yield h(this._auth),{message:"Usuario eliminado"}}else{let{name:s,lastname:n}=this.getNames(t.user.displayName);this._familyService.addFamily({id:i.mockUp?this._utils.generateId():this._auth.currentUser?.uid,nombres:s,apellidos:n,admin:!1,foto:t.user.photoURL??void 0,deleted:!1})}return t}catch(t){throw t}finally{this._loaderService.hide()}})}getNames(t){if(!t)return{name:"Actualiza tu nombre",lastname:""};let e=t.split(" ");switch(e.length){case 1:return{name:e[0],lastname:""};case 2:return{name:e[0],lastname:e[1]};case 3:return{name:e[0],lastname:`${e[1]} ${e[2]}`};case 4:return{name:`${e[0]} ${e[1]}`,lastname:`${e[2]} ${e[3]}`};default:return{name:e[0],lastname:`${e[1]} ${e[2]}`}}}static \u0275fac=function(e){return new(e||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{c as a,k as b};
