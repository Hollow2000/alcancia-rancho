import{A as c,B as g,C as b,n as a,o as $,q as S,s as y,t as k,u as n,v as p,x as l,y as d,z as w}from"./chunk-DWDFKIHE.js";import{X as v,ba as m,cb as r}from"./chunk-UK2LV4O3.js";import{e as o}from"./chunk-ACKELEN3.js";var u="ahorros",_=class h{_firestore=m(S);_collectionRef=k(this._firestore,u);_utils=m($);savings$=r([]);loading$=r(!1);mockSavings$=r(b.Savings);getSavings(t=1){if(this.loading$.set(!0),a.mockUp)switch(setTimeout(()=>{this.loading$.set(!1)},2e3),t){case 0:return this.mockSavings$;case 1:return r(this.mockSavings$().filter(s=>s.activo));case 2:return r(this.mockSavings$().filter(s=>!s.activo))}let i,e;switch(t){case 0:e=d(this._collectionRef,l("nombre","asc"));break;case 1:e=d(this._collectionRef,g("activo","==",!0),l("nombre","asc"));break;case 2:e=d(this._collectionRef,g("activo","==",!1),l("nombre","asc"));break}return i=y(e,{idField:"id"}),i.subscribe({next:s=>{this.savings$.set(s),this.loading$.set(!1)},error:s=>{this.loading$.set(!1),console.error("Error al obtener la colecci\xF3n "+u+": ",s)}}),this.savings$}getSaving(t){return o(this,null,function*(){if(this.loading$.set(!0),a.mockUp)return yield this._utils.delay(1),this.loading$.set(!1),this.mockSavings$().find(i=>i.id===t);try{let i=(yield p(n(this._firestore,u,t))).data();return i.id=t,i}catch(i){throw i}finally{this.loading$.set(!1)}})}addSaving(t){return o(this,null,function*(){if(this.loading$.set(!0),a.mockUp){yield this._utils.delay(1),t.id=this._utils.generateId(),this.mockSavings$.set(this.mockSavings$().concat(t)),this.loading$.set(!1);return}try{yield w(n(this._collectionRef),t)}catch(i){throw i}finally{this.loading$.set(!1)}})}updateSaving(t){return o(this,null,function*(){if(this.loading$.set(!0),a.mockUp){yield this._utils.delay(1);let i=this.mockSavings$().findIndex(s=>s.id===t.id),e=this.mockSavings$();e[i]=t,this.mockSavings$.set(e),this.loading$.set(!1);return}try{yield c(n(this._collectionRef,t.id),{nombre:t.nombre,meta:t.meta})}catch(i){throw i}finally{this.loading$.set(!1)}})}save(t,i){return o(this,null,function*(){if(this.loading$.set(!0),a.mockUp){yield this._utils.delay(1);let e=this.mockSavings$().findIndex(f=>f.id===t.id),s=this.mockSavings$();s[e].cantidad+=i,this.mockSavings$.set(s),this.loading$.set(!1);return}try{yield c(n(this._collectionRef,t.id),{cantidad:t.cantidad+i})}catch(e){throw e}finally{this.loading$.set(!1)}})}withdraw(t,i){return o(this,null,function*(){if(this.loading$.set(!0),a.mockUp){yield this._utils.delay(1);let e=this.mockSavings$().findIndex(f=>f.id===t.id),s=this.mockSavings$();s[e].cantidad-=i,this.mockSavings$.set(s),this.loading$.set(!1);return}try{yield c(n(this._collectionRef,t.id),{cantidad:t.cantidad-i})}catch(e){throw e}finally{this.loading$.set(!1)}})}deleteSaving(t){return o(this,null,function*(){if(this.loading$.set(!0),a.mockUp){yield this._utils.delay(1);let i=this.mockSavings$().findIndex(s=>s.id===t),e=this.mockSavings$();e[i].activo=!1,this.mockSavings$.set(e),this.loading$.set(!1);return}try{yield c(n(this._collectionRef,t),{activo:!1})}catch(i){throw i}finally{this.loading$.set(!1)}})}static \u0275fac=function(i){return new(i||h)};static \u0275prov=v({token:h,factory:h.\u0275fac,providedIn:"root"})};export{_ as a};
