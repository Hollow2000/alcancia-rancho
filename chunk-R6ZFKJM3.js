import{B as l,C as _,n as d,o as g,p,q as y,s as $,t as k,u as M,x as c,y as m,z as w}from"./chunk-U7IMLVNQ.js";import{X as D,ba as u,cb as r}from"./chunk-UK2LV4O3.js";import{a as n,b as a,e as v}from"./chunk-ACKELEN3.js";var O="movimientos",b=class h{_firestore=u(y);_collectionRef=k(this._firestore,O);_utils=u(g);movements$=r([]);loading$=r(!1);mockMovements=r(_.Movements);getMovement(e,t){if(this.loading$.set(!0),d.mockUp)return setTimeout(()=>{this.loading$.set(!1)},2e3),e&&t?r(this.mockMovements().filter(i=>i.idAhorros===e.id&&i.tipo===t.id)):t?r(this.mockMovements().filter(i=>i.tipo===t.id)):e?r(this.mockMovements().filter(i=>i.idAhorros===e.id)):this.mockMovements;let o;e&&t?o=m(this._collectionRef,l("idAhorros","==",e.id),l("tipo","==",t.id),c("fecha","desc")):t?o=m(this._collectionRef,l("tipo","==",t.id),c("fecha","desc")):e?o=m(this._collectionRef,l("idAhorros","==",e.id),c("fecha","desc")):o=m(this._collectionRef,c("fecha","desc"));try{$(o,{idField:"id"}).subscribe({next:f=>{this.movements$.set(f.map(s=>({id:s.id,cantidad:s.cantidad,tipo:s.tipo,descripcion:s.descripcion,fecha:s.fecha.toDate().toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"}),familiar:s.familiar,idAhorros:s.idAhorros}))),this.loading$.set(!1)},error:f=>{throw this.loading$.set(!1),f}})}catch(i){throw this.loading$.set(!1),i}return this.movements$}withDraw(e){return v(this,null,function*(){if(this.loading$.set(!0),d.mockUp){e.fecha=new Date(e.fecha).toLocaleDateString("es-ES",{dateStyle:"long"}),yield this._utils.delay(1);let o=a(n({},e),{id:this._utils.generateId(),tipo:"retiro"});this.mockMovements.set(this.mockMovements().concat(o)),this.loading$.set(!1);return}let t=a(n({},e),{fecha:p.fromDate(new Date(e.fecha)),tipo:"retiro"});try{yield w(M(this._collectionRef),t)}catch(o){throw o}finally{this.loading$.set(!1)}})}save(e){return v(this,null,function*(){if(this.loading$.set(!0),d.mockUp){e.fecha=new Date(e.fecha).toLocaleDateString("es-ES",{dateStyle:"long"}),yield this._utils.delay(1);let o=a(n({},e),{id:this._utils.generateId(),tipo:"deposito"});this.mockMovements.set(this.mockMovements().concat(o)),this.loading$.set(!1);return}let t=a(n({},e),{fecha:p.fromDate(new Date(e.fecha)),tipo:"deposito"});try{yield w(M(this._collectionRef),t)}catch(o){throw o}finally{this.loading$.set(!1)}})}static \u0275fac=function(t){return new(t||h)};static \u0275prov=D({token:h,factory:h.\u0275fac,providedIn:"root"})};export{b as a};
