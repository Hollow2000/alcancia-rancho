import{D as U,c as l,d as u,f as d,g as m,i as f,j as g,k as v,l as _,m as p,n as i,o as y}from"./chunk-U7IMLVNQ.js";import{X as n,ba as o,g as h}from"./chunk-UK2LV4O3.js";import{e as a}from"./chunk-ACKELEN3.js";var c=class s{concurrentReq=0;_isLoading=new h(0);isLoading=this._isLoading.asObservable();show(){this._isLoading.next(++this.concurrentReq)}hide(){this._isLoading.next(--this.concurrentReq)}static \u0275fac=function(e){return new(e||s)};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};var w=class s{_auth=o(u);_utils=o(y);_loaderService=o(c);_familyService=o(U);mockIsLogged=i.isLogged;constructor(){this._auth.useDeviceLanguage()}get authState$(){return d(this._auth)}isAdmin(){return a(this,null,function*(){return this._auth.currentUser?.uid?(yield this._familyService.getFamily(this._auth.currentUser?.uid))?.admin??!1:!1})}logOut(){return a(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!1,Promise.resolve();let t=yield _(this._auth);return this._loaderService.hide(),t})}singUp(t,e){return a(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!0,Promise.resolve();try{return yield m(this._auth,t,e)}catch(r){throw r}finally{this._loaderService.hide()}})}login(t,e){return a(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!0,Promise.resolve();yield g(this._auth,t,e).then(r=>(this._loaderService.hide(),r)).catch(r=>{throw this._loaderService.hide(),r})})}recoverPassword(t){return a(this,null,function*(){this._loaderService.show();try{yield f(this._auth,t)}catch(e){throw e}finally{this._loaderService.hide()}})}updateName(t){return a(this,null,function*(){this._auth.currentUser&&!i.mockUp&&(this._familyService.loading$.set(!0),yield p(this._auth.currentUser,{displayName:t}),this._familyService.loading$.set(!1))})}getUserName(){return i.mockUp?"Mock Up":this._auth.currentUser?.displayName}getUID(){return i.mockUp?null:this._auth.currentUser?.uid}getUserImage(){return i.mockUp?void 0:this._auth.currentUser?.photoURL??void 0}signInWithGoogle(){return a(this,null,function*(){if(this._loaderService.show(),i.mockUp)return yield this._utils.delay(2),this._loaderService.hide(),this.mockIsLogged=!0,Promise.resolve();let t=yield v(this._auth,new l);if(!(yield this._familyService.getFamily(this._auth.currentUser?.uid))){let{name:r,lastname:S}=this.getNames(t.user.displayName);this._familyService.addFamily({id:i.mockUp?this._utils.generateId():this._auth.currentUser?.uid,nombres:r,apellidos:S,admin:!1,foto:t.user.photoURL??void 0})}return this._loaderService.hide(),t})}getNames(t){if(!t)return{name:"Actualiza tu nombre",lastname:""};let e=t.split(" ");switch(e.length){case 1:return{name:e[0],lastname:""};case 2:return{name:e[0],lastname:e[1]};case 3:return{name:e[0],lastname:`${e[1]} ${e[2]}`};case 4:return{name:`${e[0]} ${e[1]}`,lastname:`${e[2]} ${e[3]}`};default:return{name:e[0],lastname:`${e[1]} ${e[2]}`}}}static \u0275fac=function(e){return new(e||s)};static \u0275prov=n({token:s,factory:s.\u0275fac,providedIn:"root"})};export{c as a,w as b};
